from Blackbox import MalwareDetectionModels
from DataUploader import UploadData
import tensorflow as tf

''' Used to start the training process for the blackbox detector '''

width = 256
height = 256
uploader = UploadData()
tf.config.list_physical_devices(device_type='GPU')
print("Num GPUs Available: ", len(tf.config.experimental.list_physical_devices('GPU')))

if tf.test.gpu_device_name():
    print('Default GPU Device: {}'.format(tf.test.gpu_device_name()))
else:
    print("Please install GPU version of TF")
    
# upload the dataset of images related to malicious files (already converted using a colormap)
mal_train, mal_val = uploader.upload_train_mal_set()
mal_test = uploader.upload_test_mal_set()

# upload the dataset of images related to benign files (already converted using a colormap)
ben_train, ben_val = uploader.upload_train_ben_set()
ben_test = uploader.upload_test_ben_set()

# create the mixed dataset to train the blackbox detector
mixed_train, mixed_val = uploader.upload_training_set(ben_train, ben_val,mal_train, mal_val)
mixed_test = uploader.upload_test_set(ben_test,mal_test)

bb_detector = MalwareDetectionModels(width, height, 'M11',mixed_train, mixed_val,mixed_test,loaded=False) 